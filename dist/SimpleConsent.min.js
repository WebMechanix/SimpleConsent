/**!
 * SimpleConsent.js
 * 
 * Author: Derek Cavaliero (@derekcavaliero)
 * Repository: https://github.com/derekcavaliero/SimpleConsent
 * Version: 1.0.alpha
 * License: MIT
 */
class SimpleConsent{static#t=null;#e=null;#n=null;#i="simple-consent";#s=1;#o=["acceptAll","acceptSelected","close","denyAll","saveSettings","showSettings"];#c={};#a={actions:{banner:{_order:["showSettings","denyAll","acceptAll"],showSettings:!0,denyAll:!0,acceptAll:!0},modal:{_order:["denyAll","saveSettings","acceptSelected","acceptAll"],acceptAll:!0,acceptSelected:!0,saveSettings:!0,denyAll:!0}},consentModel:"opt-in",consentOn:!1,consentRequired:!1,content:{banner:{heading:"Privacy Notice",description:"This website uses cookies (or other browser storage) to deliver our services and/or analyze our website usage. This information is also shared with advertising partners through the use of tracking scripts/pixels.",actions:{acceptAll:"Accept All",denyAll:"Deny All",showSettings:"Edit Preferences"}},links:{privacyPolicy:{text:"Privacy Policy",url:"#/privacy-policy"},termsOfService:null,cookiePolicy:{text:"Cookie Policy",url:"#/cookie-policy"}},modal:{heading:"Your Privacy Choices",description:"This website uses services that utilize storage features in your browser (via cookies or other browser storage functionality) to collect information. You can choose to grant or deny certain types of data collection using the controls below.",toggleAll:"Enable/Disable All",actions:{acceptAll:"Accept All",acceptSelected:"Accept Selected",denyAll:"Deny All",saveSettings:"Save Preferences"}},notices:{required:{badge:"Always Enabled"},gpc:{badge:"Disabled by GPC",description:"Some services have been automatically disabled to respect your Global Privacy Control opt-out signal."}}},cookieDomain:null,cookieExpiryDays:365,geoLocate:null,gtm:{containerId:null,loadContainer:!1},l10n:{},locale:null,onInit:function(t){},onUpdateAfter:function(t){},onUpdateBefore:function(t){},services:{},storageMethod:"hybrid",storageName:"simple_consent",templates:{banner:'<div class="consent-banner"><div class="consent-ui__content" role="alert" aria-labelledby="consentBannerHeading" aria-describedby="consentBannerDescription"><div class="consent-ui__header"><h2 class="consent-banner__heading" id="consentBannerHeading">{{ heading }}</h2><button aria-label="Close" data-consent-close></button></div><div class="consent-banner__description" id="consentBannerDescription">{{ description }}</div><div data-consent-notices></div><div data-consent-actions></div><div data-consent-links class="consent-ui__footer"></div></div></div>',modal:'<div class="consent-modal" aria-labelledby="consentModalHeading" aria-describedby="consentModalDescription"><div class="consent-ui__content"><div class="consent-ui__header"><h2 class="consent-modal__heading" id="consentModalHeading">{{ heading }}</h2><button aria-label="Close" data-consent-close></button></div><div class="consent-modal__description" id="consentModalDescription">{{ description }}</div><div data-consent-notices></div><form data-consent-settings><div data-consent-types class="consent-modal__body"></div><div data-consent-actions></div></form><div data-consent-links class="consent-ui__footer"></div></div></div>',notice:"<div>{{ description }}</div>",settingsButton:'<button><svg xmlns="http://www.w3.org/2000/svg" height="24px" width="24px" viewBox="0 -960 960 960" fill="currentColor" style="pointer-events: none"><path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-75 29-147t81-128.5q52-56.5 125-91T475-881q21 0 43 2t45 7q-9 45 6 85t45 66.5q30 26.5 71.5 36.5t85.5-5q-26 59 7.5 113t99.5 56q1 11 1.5 20.5t.5 20.5q0 82-31.5 154.5t-85.5 127q-54 54.5-127 86T480-80Zm-60-480q25 0 42.5-17.5T480-620q0-25-17.5-42.5T420-680q-25 0-42.5 17.5T360-620q0 25 17.5 42.5T420-560Zm-80 200q25 0 42.5-17.5T400-420q0-25-17.5-42.5T340-480q-25 0-42.5 17.5T280-420q0 25 17.5 42.5T340-360Zm260 40q17 0 28.5-11.5T640-360q0-17-11.5-28.5T600-400q-17 0-28.5 11.5T560-360q0 17 11.5 28.5T600-320ZM480-160q122 0 216.5-84T800-458q-50-22-78.5-60T683-603q-77-11-132-66t-68-132q-80-2-140.5 29t-101 79.5Q201-644 180.5-587T160-480q0 133 93.5 226.5T480-160Zm0-324Z"/></svg></button>',type:'<div class="consent-type"><div class="consent-switch"><input type="checkbox" role="switch" id="type-{{ key }}" name="{{ key }}"><div class="consent-switch__text"><label for="type-{{ key }}">{{ name }}</label><div>{{ description }}</div><div data-consent-type-services></div></div></div></div>'},types:{},ui:{actionClasses:{_all:null,acceptAll:null,acceptSelected:null,denyAll:null,showSettings:null,saveSettings:null},placement:{banner:["bottom","left"],settingsButton:["bottom","left"]},rootClass:"simple-consent",rootId:"simple-consent",showBranding:!0}};#l=null;#r={gpc:navigator.globalPrivacyControl||!1,dnt:navigator.doNotTrack||!1};#d={necessary:{key:"necessary",name:"Strictly Necessary",description:"These cookies/services are required for our website(s) to function properly and cannot be disabled.",required:!0}};#h={banner:null,modal:null,root:null,settings:null,settingsButton:null};constructor(t){if(SimpleConsent.#t)return SimpleConsent.#t;SimpleConsent.#t=this;try{this.#g(t)}catch(t){}}get#u(){return this.constructor.name}get#p(){const t={};for(let[e,n]of Object.entries(this.#c.services))for(let e of n.types)t[e]||(t[e]=[]),t[e].push(n);return t}get config(){return this.#c}get signals(){return this.#r}get storage(){if(this.#l)return this.#l;if(["localstorage","hybrid"].includes(this.#c.storageMethod)){let t=localStorage.getItem(this.#c.storageName);if(t)return this.#l=JSON.parse(t),this.#l}if(["cookie","hybrid"].includes(this.#c.storageMethod)){let t=`${this.#c.storageName}=`,e=decodeURIComponent(document.cookie).split(";");for(let n=0;n<e.length;n++){let i=e[n];for(;" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return JSON.parse(i.substring(t.length,i.length))}}return null}async#g(t){if(t._default){this.#n=t,t=t._default,this.#c=this.#m(this.#a,t);let e=this.#n._router;this.#c.geoLocate&&"function"==typeof this.#c.geoLocate&&this.#c.geoLocate().then((t=>{this.#e=t,e?(e.forEach((e=>{e.geoMatch&&t.match(e.geoMatch)&&this.#n.hasOwnProperty(e.config)&&(this.#c=this.#m(this.#c,this.#n[e.config]))})),this.#f()):this.#f()}))}else this.#c=this.#m(this.#a,t),this.#f()}#f(){this.#c.cookieDomain=this.#y(),this.#d=this.#m(this.#d,this.#c.types),this.#v(),this.#b(),this.#w(),this.#S(),this.#A(),this.#T(),this.#C(),this.#k(),"function"==typeof this.#c.onInit&&(this.#c.onInit(this.#l),this.#_("init",this.#l))}#b(){document.addEventListener(`${this.#i}:modal.show.before`,(t=>{const e=t.detail.querySelectorAll("[data-consent-action]");if(!this.#l._datetime)return e.forEach((t=>{t.style.display="saveSettings"!==t.getAttribute("data-consent-action")?"block":"none"})),void this.hide("banner");e.forEach((t=>{t.style.display="saveSettings"!==t.getAttribute("data-consent-action")?"none":"block"}))})),document.addEventListener(`${this.#i}:modal.close.before`,(t=>{this.#l._datetime||this.show("banner")})),document.addEventListener(`${this.#i}:settings.update`,(t=>{this.#q("update"),this.show("settingsButton")})),document.addEventListener(`${this.#i}:settings.load`,(t=>{this.#q("default")}))}#A(){document.addEventListener("keyup",(t=>{"Escape"===t.key&&this.#h.modal&&this.#h.modal.classList.contains("is-open")&&this.#h.modal.querySelector("[data-consent-close]").click()})),document.addEventListener("click",(t=>{let e=t.target.closest("[data-consent-action]");if(e)return t.preventDefault(),void this[{showSettings:"show",acceptAll:"accept",acceptSelected:"save",denyAll:"deny",saveSettings:"save"}[e.dataset.consentAction]]();t.target.hasAttribute("data-consent-close")&&(t.preventDefault(),this.#E(t.target))}))}#T(){if(!this.#c.consentOn||this.#l._datetime)return;const t=()=>{this.changeAll(),this.save(!0),o()},e=e=>{window.scrollY<.05*window.innerHeight||t()},n=((t,e)=>{let n;return function(...i){clearTimeout(n),n=setTimeout((()=>t.apply(this,i)),e)}})(e,100);this.#c.consentOn.includes("scroll")&&document.addEventListener("scroll",n);const i=e=>{e.target.closest("[data-consent-tpl]")||t()};this.#c.consentOn.includes("click")&&document.addEventListener("mousedown",i);const s=e=>{t()};this.#c.consentOn.includes("banner.close")&&document.addEventListener(`${this.#i}:banner.close.after`,s);const o=()=>{document.removeEventListener("mousedown",i),document.removeEventListener(`${this.#i}:banner.close.after'`,s),document.removeEventListener("scroll",e)}}#L(t){return t?"granted":"denied"}#M(t,e){for(const n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])}#O(){let t={};if(this.#l)for(let e in this.#l)this.#l.hasOwnProperty(e)&&!e.startsWith("_")&&(t[e]=this.#L(this.#l[e]),this.#d[e]&&this.#d[e].mapTo&&this.#d[e].mapTo.forEach((n=>{t[n]=this.#L(this.#l[e])})));return t}#E(t){if(this.#c.consentRequired&&!this.#l)return;const e=t.closest("[data-consent-tpl]");e&&(this.#_(`${e.dataset.consentTpl}.close.before`,e),e.classList.remove("is-open"),this.#_(`${e.dataset.consentTpl}.close.after`,e))}#m(t,e){for(const n in e)e.hasOwnProperty(n)&&(Array.isArray(e[n])?t[n]=e[n].slice():"object"==typeof e[n]&&null!==e[n]?(t[n]||(t[n]={}),this.#m(t[n],e[n])):t[n]=e[n]);return t}#D(t){return this.#d[t]||!1}#v(){window.dataLayer=window.dataLayer||[]}#S(){this.#c.gtm.loadContainer&&this.#c.gtm.containerId&&function(t,e,n,i,s){t[i]=t[i]||[],t[i].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var o=e.getElementsByTagName(n)[0],c=e.createElement(n);c.async=!0,c.src="https://www.googletagmanager.com/gtm.js?id="+s,o.parentNode.insertBefore(c,o)}(window,document,"script","dataLayer",this.#c.gtm.containerId)}#q(t){let e=this.#O(),n={default:"load"}[t]||t;e.event=`${this.#i}.${n}`,e.consent={model:this.#c.consentModel,geo:this.#e},window.dataLayer.push(e),this.#_("datalayer.push",e)}#_(t,e){const n=new CustomEvent(`${this.#i}:${t}`,{detail:e});document.dispatchEvent(n)}#$(){this.hide("modal"),this.hide("banner")}#w(){if(this.#l=this.storage,this.#l)return void this.#_("settings.load",this.#l);this.#l={},this.#c.consentModel=this.#c.consentModel.toLowerCase().trim(),["opt-in","opt-out"].includes(this.#c.consentModel)||(this.#c.consentModel="opt-in");let t={"opt-in":!1,"opt-out":!0}[this.#c.consentModel];this.#r.gpc&&(t=!this.#r.gpc&&t);for(let[e,n]of Object.entries(this.#d))this.#l[e]=!!n.required||t;this.#_("settings.load",this.#l)}#C(){if(!this.#c.l10n)return;if(!this.#c.locale){const t=document.documentElement.lang;this.#c.locale=t||null}if(!this.#c.locale)return;this.#c.locale=this.#c.locale.toLowerCase();const t=this.#c.l10n[this.#c.locale];t&&(t.content&&(this.#c.content=this.#m(this.#c.content,t.content)),t.services&&(this.#c.services=t.services),t.types&&(this.#d=t.types))}#k(){const t=document.createElement("div");if(t.id=this.#c.ui.rootId,t.className=this.#c.ui.rootClass,this.#M(t,{"data-consent-tpl":"root"}),this.#h.modal=this.#P("modal",this.#c.content.modal),this.#M(this.#h.modal,{role:"dialog"}),this.#B(this.#h.modal),this.#x(this.#l,this.#h),t.appendChild(this.#h.modal),this.#h.banner=this.#P("banner",this.#c.content.banner),this.#B(this.#h.banner),this.#M(this.#h.banner,{"data-consent-placement":this.#c.ui.placement.banner.join(",")}),t.appendChild(this.#h.banner),this.#r.gpc){let e=t.querySelectorAll("[data-consent-notices]");for(let t of e){let e=this.#P("notice",this.#c.content.notices.gpc);this.#M(e,{"data-consent-tpl":"notice","data-consent-notice":"info"}),t.appendChild(e)}}this.#I(t),this.#h.settingsButton=this.#P("settingsButton",{}),this.#M(this.#h.settingsButton,{"data-consent-tpl":"settingsButton","data-consent-action":"showSettings","data-consent-placement":this.#c.ui.placement.settingsButton.join(","),title:"Edit Preferences"}),t.appendChild(this.#h.settingsButton),document.body.appendChild(t),this.#h.root=t,this.#N()}#B(t){const e=t.dataset.consentTpl,n=this.#c.actions[e],i=t.querySelector("[data-consent-actions]");if(i)for(let t of this.#c.actions[e]._order){if(!n.hasOwnProperty(t)||!n[t]||!this.#o.includes(t))continue;let s=document.createElement("button");this.#c.ui.actionClasses._all&&s.classList.add(...this.#c.ui.actionClasses._all.split(" ")),this.#c.ui.actionClasses[t]&&s.classList.add(...this.#c.ui.actionClasses[t].split(" ")),s.setAttribute("data-consent-action",t),s.textContent=this.#c.content[e].actions[t],i.append(s)}}#x(){this.#p;for(let[t,e]of Object.entries(this.#d)){this.#d[t].key=t;const n=this.#P("type",e);this.#M(n,{"data-consent-type":t});const i=n.querySelector("input");i.checked=!!this.#l[t],e.required&&(i.disabled=!0,i.checked=!0),this.#r.gpc&&e.gpc&&(i.disabled=!0,i.checked=!1,i.title=this.#c.content.notices.gpc.description),this.#h.modal.querySelector("[data-consent-types]").appendChild(n)}this.#h.settings=this.#h.modal.querySelectorAll("[data-consent-settings] input")}#I(t){const e=this.#c.content.links,n=t.querySelectorAll("[data-consent-links]");if(n.length)for(let t of n){let n=0;for(let i in e){if(!e.hasOwnProperty(i)||!e[i])continue;if(n>0){let e=document.createElement("span");e.setAttribute("data-consent-link-delimiter",""),t.appendChild(e)}let s=document.createElement("a");s.href=e[i].url,s.textContent=e[i].text,t.appendChild(s),n++}if(t.closest('[data-consent-tpl="modal"]')&&this.#c.ui.showBranding){let e=document.createElement("a");e.setAttribute("data-consent-branding",""),e.href="https://github.com/derekcavaliero/simpleconsent/",e.textContent=`Powered by ${this.#u}`,t.appendChild(e)}}}#P(t,e={}){const n=document.createElement("template");n.innerHTML=this.#c.templates[t].trim();for(let t in e)e.hasOwnProperty(t)&&!["actions","required"].includes(t)&&"string"==typeof e[t]&&(n.innerHTML=this.#j(n.innerHTML,t,e[t]));return this.#M(n.content.firstChild,{"data-consent-tpl":t}),n.content.firstChild}#y(){if(this.#c.cookieDomain)return this.#c.cookieDomain;const t=window.location.hostname;if("localhost"===t)return"";const e=t.split(".").reverse();let n=e[1]+"."+e[0];return e.length>2&&e[1].length<=3&&(n=e[2]+"."+n),n}#j(t,e,n){let i=new RegExp(`{{ ${e} }}`,"g"),s=n.replace(/<[^>]*>?/gm,"");return s=this.#U(s),t.replace(i,s)}#U(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}#N(){const t=this.#c.consentRequired;this.#l._datetime?this.show("settingsButton"):t?this.show("modal"):this.show("banner")}#H(t){["cookie","hybrid"].includes(this.#c.storageMethod)&&(document.cookie=`${this.#c.storageName}=${JSON.stringify(t)}; expires=${new Date(Date.now()+24*this.#c.cookieExpiryDays*60*60*1e3).toUTCString()}; path=/; domain=${this.#c.cookieDomain}`),["cookie","hybrid"].includes(this.#c.storageMethod)&&localStorage.setItem(this.#c.storageName,JSON.stringify(t))}#R(){localStorage.removeItem(this.#c.storageName),document.cookie=`${this.#c.storageName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=${this.#c.cookieDomain}`}accept(){this.changeAll(),this.save()}changeAll(t=!0){this.#h.settings.forEach((e=>{e.disabled||(e.checked=t)}))}deny(){this.changeAll(!1),this.save()}destroy(){this.#_("destroy"),this.#h.root.remove(),this.#R(),SimpleConsent.#t&&(SimpleConsent.#t=null)}hide(t="modal"){this.#c.consentRequired&&!this.#l||this.#h[t].classList.remove("is-open")}reset(){this.#_("reset"),this.#R(),this.#l=null,this.#w(),this.#T(),this.changeAll("opt-in"!==this.#c.consentModel),this.#N()}save(t=!1){"function"==typeof this.#c.onUpdateBefore&&this.#c.onUpdateBefore(this.#l),this.#l||(this.#l={});for(let t of this.#h.settings){if("necessary"==t.name)continue;const e=this.#D(t.name);this.#l[t.name]=t.checked,e.mapTo&&Array.isArray(e.mapTo)&&e.mapTo.forEach((e=>{this.#l[e]=t.checked,this.#_(`${e}.${this.#L(t.checked)}`)}));t.checked;this.#_(`${t.name}.${this.#L(t.checked)}`)}Object.entries({_datetime:(new Date).toISOString(),_id:crypto.randomUUID(),_geo:this.#e,_gpc:this.#r.gpc,_model:`${this.#c.consentModel}/`+(t?"implicit":"explicit"),_version:this.#s}).forEach((([t,e])=>{this.#l[t]=e})),this.#H(this.#l),this.#_("settings.update",this.#l),"function"==typeof this.#c.onUpdateAfter&&this.#c.onUpdateAfter(this.#l),setTimeout((()=>this.#$()),150)}show(t="modal"){this.#_(`${t}.show.before`,this.#h[t]),this.#h[t].classList.add("is-open"),this.#_(`${t}.show.after`,this.#h[t])}static manager(t){return SimpleConsent.#t||(SimpleConsent.#t=new SimpleConsent(t)),SimpleConsent.#t}}document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelector("script[data-consent-config]");if(!t)return;let e=window[t.dataset.consentConfig]||{};new SimpleConsent(e),delete window[t.dataset.consentConfig]}));
