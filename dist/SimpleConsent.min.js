/**!
 * SimpleConsent.js
 * 
 * Most consent/cookie banners are too bloated and try to be "everything to everyone" - SimpleConsent is hyperfocused on ease of use, 
 * particularly with Google Tag Manager's "Consent" APIs.
 * 
 * Author: Derek Cavaliero (@derekcavaliero)
 * Repository: https://github.com/derekcavaliero/SimpleConsent
 * Version: 1.0.beta
 * License: MIT
 */
class SimpleConsent{static#t=null;#e=null;#n="simple-consent";#i=1;#s=null;#o=["acceptAll","acceptSelected","close","denyAll","saveSettings","showSettings"];#a={actions:{banner:{_order:["showSettings","denyAll","acceptAll"],showSettings:!0,denyAll:!0,acceptAll:!0},modal:{_order:["denyAll","saveSettings","acceptSelected","acceptAll"],acceptAll:!0,acceptSelected:!0,saveSettings:!0,denyAll:!0}},consentModel:"opt-in",cookieDomain:null,cookieExpiryDays:365,cookieName:"simple_consent",dataLayer:window.dataLayer||[],forceConsent:!1,impliedConsentOn:!1,l10n:{},locale:null,geoLocate:null,onInit:function(t){},onUpdateAfter:function(t){},onUpdateBefore:function(t){},services:[],showEmptyTypes:!1,templates:{banner:'\n              <div class="consent-banner">\n                <div class="consent-ui__content" role="alert" aria-labelledby="consentBannerHeading" aria-describedby="consentBannerDescription">\n                  <div class="consent-ui__header">\n                    <h2 class="consent-banner__heading" id="consentBannerHeading">\n                      {{ heading }}\n                    </h2>\n                    <button aria-label="Close" data-consent-close></button>\n                  </div>\n                  <div class="consent-banner__description" id="consentBannerDescription">{{ description }}</div>\n                  <div data-consent-actions></div>\n                  <div data-consent-links class="consent-ui__footer"></div>\n                </div>\n              </div>\n              ',modal:'\n              <div class="consent-modal" aria-labelledby="consentModalHeading" aria-describedby="consentModalDescription">\n                <div class="consent-ui__content">\n                  <div class="consent-ui__header">\n                    <h2 class="consent-modal__heading" id="consentModalHeading">{{ heading }}</h2>\n                    <button aria-label="Close" data-consent-close></button>\n                  </div>\n                  <div class="consent-modal__description" id="consentModalDescription">{{ description }}</div>\n                  <form data-consent-settings>\n                    <div data-consent-types class="consent-modal__body">\n                    </div>\n                    <div data-consent-actions></div>\n                  </form>\n                  <div data-consent-links class="consent-ui__footer"></div>\n                </div>\n              </div>\n              ',type:'\n              <div class="consent-type">\n                <div class="consent-switch">\n                  <input type="checkbox" role="switch" id="type-{{ key }}" name="{{ key }}">\n                  <div class="consent-switch__text">\n                    <label for="type-{{ key }}">{{ label }}</label>\n                    <div>{{ description }}</div>\n                    <div data-consent-type-services></div>\n                  </div>\n                </div>\n              </div>\n              '},content:{links:{privacyPolicy:{text:"Privacy Policy",url:"#/privacy-policy"},termsOfService:null,cookiePolicy:{text:"Cookie Policy",url:"#/cookie-policy"}},banner:{heading:"Privacy Notice",description:"This website uses cookies (or other browser storage) to deliver our services and/or analyze our website usage. This information is also shared with some of our advertising partners throught the use of tracking pixels.",actions:{acceptAll:"Accept All",denyAll:"Decline All",showSettings:"Edit Settings"}},modal:{heading:"Consent & Privacy Settings",description:"This website uses services that utilize storage features in your browser (via cookies or other browser storage functionality) to collect information. You can choose to grant or deny certain types of data collection using the controls below.",toggleAll:"Enable/Disable All",actions:{acceptAll:"Accept All",acceptSelected:"Accept Selected",denyAll:"Decline All",saveSettings:"Save Preferences"}},urls:{privacyPolicy:"#/privacy-policy",termsOfService:"#/terms-of-service",cookiePolicy:"#/cookie-policy"}},theme:{actionClasses:{_all:null,acceptAll:null,acceptSelected:null,denyAll:null,showSettings:null,saveSettings:null},placement:{banner:["bottom","left"]},rootClass:"simple-consent",rootId:"simple-consent",scheme:"light"}};#c=null;#l=[{key:"necessary",label:"Strictly Necessary",description:"These cookies/services are required for our website(s) to function and cannot be disabled.",required:!0},{key:"analytics_storage",label:"Analytics Storage",description:"Enables storage, such as cookies and/or local/session storage related to analytics, for example, visit duration, and pages viewed."},{key:"ad_storage",label:"Advertising Storage",description:"Enables storage, such as cookies and/or local/session storage related to advertising."},{key:"ad_personalization",label:"Advertising Personalization",description:"Set consent for personalized advertising through the use of 3rd party cookies set by our partners."},{key:"ad_user_data",label:"Ad User Data",description:"Sets consent for sending user data to our advertising partners for online advertising purposes."},{key:"functionality_storage",label:"Functionality Storage",description:"Enables storage that supports the functionality of the website or app e.g. language settings."},{key:"personalization_storage",label:"Personalization Storage",description:"Enables storage related to personalization e.g. video recommendations, and account preferences."},{key:"security_storage",label:"Security Storage",description:"Enables services/storage related to security such as authentication functionality, fraud prevention, and other user protection."}];#r={banner:null,modal:null,root:null,settings:null};constructor(t){if(SimpleConsent.#t)return SimpleConsent.#t;SimpleConsent.#t=this,this.#d(t)}get#h(){return this.constructor.name}async#d(t){if(t._default){this.#e=t,t=t._default,this.#a=this.#g(this.#a,t);let e=this.#e._router;this.#a.geoLocate&&"function"==typeof this.#a.geoLocate&&this.#a.geoLocate().then((t=>{this.#s=t,e?(e.forEach((e=>{e.geoMatch&&t.match(e.geoMatch)&&this.#e.hasOwnProperty(e.config)&&(this.#a=this.#g(this.#a,this.#e[e.config]))})),this.#u()):this.#u()}))}else this.#a=this.#g(this.#a,t),this.#u()}#p(t,e){for(const n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])}#f(){document.addEventListener(`${this.#n}:modal.show.before`,(t=>{const e=t.detail.querySelectorAll("[data-consent-action]");if(!this.#c._datetime)return e.forEach((t=>{t.style.display="saveSettings"!==t.getAttribute("data-consent-action")?"block":"none"})),void this.hide("banner");e.forEach((t=>{t.style.display="saveSettings"!==t.getAttribute("data-consent-action")?"none":"block"}))})),document.addEventListener(`${this.#n}:modal.close.before`,(t=>{this.#c._datetime||this.show("banner")})),document.addEventListener(`${this.#n}:update`,(t=>{this.#m("update")})),document.addEventListener(`${this.#n}:init`,(t=>{this.#m("load")}))}#y(){document.addEventListener("click",(t=>{t.target.hasAttribute("data-consent-action")&&(t.preventDefault(),this[{showSettings:"show",acceptAll:"accept",acceptSelected:"save",denyAll:"deny",saveSettings:"save"}[t.target.dataset.consentAction]]()),t.target.hasAttribute("data-consent-close")&&(t.preventDefault(),this.#v(t.target))}))}#b(){if(!this.#a.impliedConsentOn||this.#c)return;const t=()=>{this.changeAll(),this.save(!0),o()},e=e=>{window.scrollY<.05*window.innerHeight||t()},n=((t,e)=>{let n;return function(...i){clearTimeout(n),n=setTimeout((()=>t.apply(this,i)),e)}})(e,100);this.#a.impliedConsentOn.includes("scroll")&&document.addEventListener("scroll",n);const i=e=>{e.target.closest("[data-consent-tpl]")||t()};this.#a.impliedConsentOn.includes("click")&&document.addEventListener("mousedown",i);const s=e=>{t()};this.#a.impliedConsentOn.includes("banner.close")&&document.addEventListener(`${this.#n}:banner.close.after`,s);const o=()=>{document.removeEventListener("mousedown",i),document.removeEventListener(`${this.#n}:banner.close.after'`,s),document.removeEventListener("scroll",e)}}#_(){let t={};if(this.#c)for(let e in this.#c)this.#c.hasOwnProperty(e)&&!e.startsWith("_")&&(t[e]=this.#c[e]?"granted":"denied");return t}#v(t){if(this.#a.forceConsent&&!this.#c)return;const e=t.closest("[data-consent-tpl]");e&&(this.#A(`${e.dataset.consentTpl}.close.before`,e),e.classList.remove("is-open"),this.#A(`${e.dataset.consentTpl}.close.after`,e))}#g(t,e){for(const n in e)e.hasOwnProperty(n)&&(Array.isArray(e[n])?t[n]=e[n].slice():"object"==typeof e[n]&&null!==e[n]?(t[n]||(t[n]={}),this.#g(t[n],e[n])):t[n]=e[n]);return t}#A(t,e){const n=new CustomEvent(`${this.#n}:${t}`,{detail:e});document.dispatchEvent(n)}#S(){const t={};for(let e of this.#a.services)for(let n of e.types)t[n]||(t[n]=[]),t[n].push(e);return t}#C(){this.hide("modal"),this.hide("banner")}#k(){if(this.#c=this.settings,this.#c)return;this.#c={},this.#a.consentModel=this.#a.consentModel.toLowerCase().trim(),["opt-in","opt-out"].includes(this.#a.consentModel)||(this.#a.consentModel="opt-in");let t={"opt-in":!1,"opt-out":!0}[this.#a.consentModel];navigator.globalPrivacyControl&&(t=!navigator.globalPrivacyControl&&t,this.#c._gpc=navigator.globalPrivacyControl),this.#l.forEach((e=>{this.#c[e.key]=!!e.required||t}))}#w(){if(!this.#a.l10n)return;if(!this.#a.locale){const t=document.documentElement.lang;this.#a.locale=t||null}if(!this.#a.locale)return;this.#a.locale=this.#a.locale.toLowerCase();const t=this.#a.l10n[this.#a.locale];t&&t.content&&(this.#a.content=this.#g(this.#a.content,t.content))}#E(){const t=document.createElement("div");t.id=this.#a.theme.rootId,t.className=this.#a.theme.rootClass,this.#p(t,{"data-consent-tpl":"root"}),this.#r.modal=this.#L("modal",this.#a.content.modal),this.#p(this.#r.modal,{role:"dialog"}),this.#T(this.#r.modal),this.#M(this.#c,this.#r),t.appendChild(this.#r.modal),this.#r.banner=this.#L("banner",this.#a.content.banner),this.#T(this.#r.banner),this.#p(this.#r.banner,{"data-consent-placement":this.#a.theme.placement.banner.join(",")}),t.appendChild(this.#r.banner),this.#D(t),document.body.appendChild(t),this.#r.root=t,this.#$()}#T(t){const e=t.dataset.consentTpl,n=this.#a.actions[e],i=t.querySelector("[data-consent-actions]");if(i)for(let t of this.#a.actions[e]._order){if(!n.hasOwnProperty(t)||!n[t]||!this.#o.includes(t))continue;let s=document.createElement("button");this.#a.theme.actionClasses[t]&&(this.#a.theme.actionClasses._all&&s.classList.add(...this.#a.theme.actionClasses._all.split(" ")),s.classList.add(...this.#a.theme.actionClasses[t].split(" "))),s.setAttribute("data-consent-action",t),s.textContent=this.#a.content[e].actions[t],i.append(s)}}#D(t){const e=this.#a.content.links,n=t.querySelectorAll("[data-consent-links]");if(n.length)for(let t of n){let n=0;for(let i in e){if(!e.hasOwnProperty(i)||!e[i])continue;if(n>0){let e=document.createElement("span");e.setAttribute("data-consent-link-delimiter",""),t.appendChild(e)}let s=document.createElement("a");s.href=e[i].url,s.textContent=e[i].text,t.appendChild(s),n++}}}#M(){const t=this.#S();for(let e of this.#l){if(!t[e.key]&&!e.required)continue;const n=this.#L("type",e);this.#p(n,{"data-consent-type":e.key});const i=n.querySelector("input");i.checked=!!this.#c[e.key],e.required&&(i.disabled=!0,i.checked=!0),this.#r.modal.querySelector("[data-consent-types]").appendChild(n)}this.#r.settings=this.#r.modal.querySelectorAll("[data-consent-settings] input")}#L(t,e={}){const n=document.createElement("template");n.innerHTML=this.#a.templates[t].trim();for(let t in e){if(!e.hasOwnProperty(t)||["actions","required"].includes(t))continue;let i=new RegExp(`{{ ${t} }}`,"g"),s=e[t].replace(/<\/?[^>]+(>|$)/g,"");n.innerHTML=n.innerHTML.replace(i,s)}return this.#p(n.content.firstChild,{"data-consent-tpl":t}),n.content.firstChild}#m(t){let e=this.#_();e.event=`${this.#n}.${t}`,e.consentModel=this.#a.consentModel,this.#a.dataLayer.push(e)}#u(){this.#a.cookieDomain=this.#O(),this.#k(),this.#f(),this.#y(),this.#b(),this.#w(),this.#E(),"function"==typeof this.#a.onInit&&(this.#a.onInit(this.#c),this.#A("init",this.#c))}#O(){if(this.#a.cookieDomain)return this.#a.cookieDomain;const t=window.location.hostname;if("localhost"===t)return"";const e=t.split(".").reverse();let n=e[1]+"."+e[0];return e.length>2&&e[1].length<=3&&(n=e[2]+"."+n),n}#$(){const t=this.#a.forceConsent;this.#c._datetime||(t?this.show("modal"):this.show("banner"))}static manager(t){return SimpleConsent.#t||(SimpleConsent.#t=new SimpleConsent(t)),SimpleConsent.#t}get config(){return this.#a}get settings(){if(this.#c)return this.#c;let t=`${this.#a.cookieName}=`,e=decodeURIComponent(document.cookie).split(";");for(let n=0;n<e.length;n++){let i=e[n];for(;" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return JSON.parse(i.substring(t.length,i.length))}return null}accept(){this.changeAll(),this.save()}changeAll(t=!0){this.#r.settings.forEach((e=>{e.disabled||(e.checked=t)}))}deny(){this.changeAll(!1),this.save()}hide(t="modal"){this.#a.forceConsent&&!this.#c||this.#r[t].classList.remove("is-open")}reset(){document.cookie=`${this.#a.cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=${this.#a.cookieDomain}`,this.#c=null,this.#k(),this.#b(),this.changeAll("opt-in"!==this.#a.consentModel),this.#$()}save(t=!1){"function"==typeof this.#a.onUpdateBefore&&this.#a.onUpdateBefore(this.#c),this.#c||(this.#c={});for(let t of this.#r.settings){if("necessary"==t.name)continue;this.#c[t.name]=t.checked;let e=t.checked?"granted":"denied";this.#A(`${t.name}.${e}`)}Object.entries({_datetime:(new Date).toISOString(),_id:crypto.randomUUID(),_model:`${this.#a.consentModel}/`+(t?"implicit":"explicit"),_geo:this.#s,_version:this.#i}).forEach((([t,e])=>{this.#c[t]=e})),document.cookie=`${this.#a.cookieName}=${JSON.stringify(this.#c)}; expires=${new Date(Date.now()+24*this.#a.cookieExpiryDays*60*60*1e3).toUTCString()}; path=/; domain=${this.#a.cookieDomain}`,this.#A("update",this.#c),"function"==typeof this.#a.onUpdateAfter&&this.#a.onUpdateAfter(this.#c),setTimeout((()=>this.#C()),150)}show(t="modal"){this.#A(`${t}.show.before`,this.#r[t]),this.#r[t].classList.add("is-open"),this.#A(`${t}.show.after`,this.#r[t])}}document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelector("script[data-consent-config]");if(!t)return;let e=window[t.dataset.consentConfig]||{};new SimpleConsent(e),delete window[t.dataset.consentConfig]}));
