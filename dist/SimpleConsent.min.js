/**!
 * SimpleConsent.js
 * 
 * Author: Derek Cavaliero (@derekcavaliero)
 * Repository: https://github.com/derekcavaliero/SimpleConsent
 * Version: 1.0.alpha
 * License: MIT
 */
class SimpleConsent{static#t=null;#e=null;#n=null;#i="simple-consent";#s=1;#o=["acceptAll","acceptSelected","close","denyAll","saveSettings","showSettings"];#c={actions:{banner:{_order:["showSettings","denyAll","acceptAll"],showSettings:!0,denyAll:!0,acceptAll:!0},modal:{_order:["denyAll","saveSettings","acceptSelected","acceptAll"],acceptAll:!0,acceptSelected:!0,saveSettings:!0,denyAll:!0}},consentModel:"opt-in",consentOnImplicitAction:!1,consentRequired:!1,content:{banner:{heading:"Privacy Notice",description:"This website uses cookies (or other browser storage) to deliver our services and/or analyze our website usage. This information is also shared with advertising partners through the use of tracking scripts/pixels.",actions:{acceptAll:"Accept All",denyAll:"Deny All",showSettings:"Edit Preferences"}},notices:{required:{badge:"Always Enabled"},gpc:{badge:"Disabled by GPC",heading:"Global Privacy Control (GPC)",description:"Some services have been disabled to respect your opt-out signal."}},modal:{heading:"Your Privacy Choices",description:"This website uses services that utilize storage features in your browser (via cookies or other browser storage functionality) to collect information. You can choose to grant or deny certain types of data collection using the controls below.",toggleAll:"Enable/Disable All",actions:{acceptAll:"Accept All",acceptSelected:"Accept Selected",denyAll:"Deny All",saveSettings:"Save Preferences"}},links:{privacyPolicy:{text:"Privacy Policy",url:"#/privacy-policy"},termsOfService:null,cookiePolicy:{text:"Cookie Policy",url:"#/cookie-policy"}}},cookieDomain:null,cookieExpiryDays:365,geoLocate:null,gtm:{loadContainer:!1,containerId:null},l10n:{},locale:null,onInit:function(t){},onUpdateAfter:function(t){},onUpdateBefore:function(t){},services:{},storageMethod:"hybrid",storageName:"simple_consent",templates:{banner:'\n              <div class="consent-banner">\n                <div class="consent-ui__content" role="alert" aria-labelledby="consentBannerHeading" aria-describedby="consentBannerDescription">\n                  <div class="consent-ui__header">\n                    <h2 class="consent-banner__heading" id="consentBannerHeading">\n                      {{ heading }}\n                    </h2>\n                    <button aria-label="Close" data-consent-close></button>\n                  </div>\n                  <div class="consent-banner__description" id="consentBannerDescription">{{ description }}</div>\n                  <div data-consent-notices></div>\n                  <div data-consent-actions></div>\n                  <div data-consent-links class="consent-ui__footer"></div>\n                </div>\n              </div>\n              ',modal:'\n              <div class="consent-modal" aria-labelledby="consentModalHeading" aria-describedby="consentModalDescription">\n                <div class="consent-ui__content">\n                  <div class="consent-ui__header">\n                    <h2 class="consent-modal__heading" id="consentModalHeading">{{ heading }}</h2>\n                    <button aria-label="Close" data-consent-close></button>\n                  </div>\n                  <div class="consent-modal__description" id="consentModalDescription">{{ description }}</div>\n                  <div data-consent-notices></div>\n                  <form data-consent-settings>\n                    <div data-consent-types class="consent-modal__body">\n                    </div>\n                    <div data-consent-actions></div>\n                  </form>\n                  <div data-consent-links class="consent-ui__footer"></div>\n                </div>\n              </div>\n              ',notice:"\n              <div>\n                <strong>{{ heading }}</strong>: \n                {{ description }}\n              </div>\n              ",type:'\n              <div class="consent-type">\n                <div class="consent-switch">\n                  <input type="checkbox" role="switch" id="type-{{ key }}" name="{{ key }}">\n                  <div class="consent-switch__text">\n                    <label for="type-{{ key }}">{{ name }}</label>\n                    <div>{{ description }}</div>\n                    <div data-consent-type-services></div>\n                  </div>\n                </div>\n              </div>\n              '},types:{},ui:{actionClasses:{_all:null,acceptAll:null,acceptSelected:null,denyAll:null,showSettings:null,saveSettings:null},placement:{banner:["bottom","left"]},rootClass:"simple-consent",rootId:"simple-consent",showBranding:!0}};#a=null;#l={necessary:{key:"necessary",name:"Strictly Necessary",description:"These cookies/services are required for our website(s) to function properly and cannot be disabled.",required:!0}};#r={banner:null,modal:null,root:null,settings:null};constructor(t){if(SimpleConsent.#t)return SimpleConsent.#t;SimpleConsent.#t=this;try{this.#d(t)}catch(t){}}get#h(){return this.constructor.name}get#g(){const t={};for(let[e,n]of Object.entries(this.#c.services))for(let e of n.types)t[e]||(t[e]=[]),t[e].push(n);return t}get config(){return this.#c}get storage(){if(this.#a)return this.#a;if(["localstorage","hybrid"].includes(this.#c.storageMethod)){let t=localStorage.getItem(this.#c.storageName);if(t)return this.#a=JSON.parse(t),this.#a}if(["cookie","hybrid"].includes(this.#c.storageMethod)){let t=`${this.#c.storageName}=`,e=decodeURIComponent(document.cookie).split(";");for(let n=0;n<e.length;n++){let i=e[n];for(;" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return JSON.parse(i.substring(t.length,i.length))}}return null}async#d(t){if(t._default){this.#n=t,t=t._default,this.#c=this.#u(this.#c,t);let e=this.#n._router;this.#c.geoLocate&&"function"==typeof this.#c.geoLocate&&this.#c.geoLocate().then((t=>{this.#e=t,e?(e.forEach((e=>{e.geoMatch&&t.match(e.geoMatch)&&this.#n.hasOwnProperty(e.config)&&(this.#c=this.#u(this.#c,this.#n[e.config]))})),this.#p()):this.#p()}))}else this.#c=this.#u(this.#c,t),this.#p()}#p(){this.#c.cookieDomain=this.#m(),this.#l=this.#u(this.#l,this.#c.types),this.#f(),this.#y(),this.#v(),this.#b(),this.#A(),this.#w(),this.#S(),this.#C(),"function"==typeof this.#c.onInit&&(this.#c.onInit(this.#a),this.#_("init",this.#a))}#y(){document.addEventListener(`${this.#i}:modal.show.before`,(t=>{const e=t.detail.querySelectorAll("[data-consent-action]");if(!this.#a._datetime)return e.forEach((t=>{t.style.display="saveSettings"!==t.getAttribute("data-consent-action")?"block":"none"})),void this.hide("banner");e.forEach((t=>{t.style.display="saveSettings"!==t.getAttribute("data-consent-action")?"none":"block"}))})),document.addEventListener(`${this.#i}:modal.close.before`,(t=>{this.#a._datetime||this.show("banner")})),document.addEventListener(`${this.#i}:settings.update`,(t=>{this.#k("update")})),document.addEventListener(`${this.#i}:settings.load`,(t=>{this.#k("default")}))}#A(){document.addEventListener("keyup",(t=>{"Escape"===t.key&&this.#r.modal&&this.#r.modal.classList.contains("is-open")&&this.#r.modal.querySelector("[data-consent-close]").click()})),document.addEventListener("click",(t=>{let e=t.target.closest("[data-consent-action]");if(e)return t.preventDefault(),void this[{showSettings:"show",acceptAll:"accept",acceptSelected:"save",denyAll:"deny",saveSettings:"save"}[e.dataset.consentAction]]();t.target.hasAttribute("data-consent-close")&&(t.preventDefault(),this.#L(t.target))}))}#w(){if(!this.#c.consentOnImplicitAction||this.#a)return;const t=()=>{this.changeAll(),this.save(!0),o()},e=e=>{window.scrollY<.05*window.innerHeight||t()},n=((t,e)=>{let n;return function(...i){clearTimeout(n),n=setTimeout((()=>t.apply(this,i)),e)}})(e,100);this.#c.consentOnImplicitAction.includes("scroll")&&document.addEventListener("scroll",n);const i=e=>{e.target.closest("[data-consent-tpl]")||t()};this.#c.consentOnImplicitAction.includes("click")&&document.addEventListener("mousedown",i);const s=e=>{t()};this.#c.consentOnImplicitAction.includes("banner.close")&&document.addEventListener(`${this.#i}:banner.close.after`,s);const o=()=>{document.removeEventListener("mousedown",i),document.removeEventListener(`${this.#i}:banner.close.after'`,s),document.removeEventListener("scroll",e)}}#E(t){return t?"granted":"denied"}#T(t,e){for(const n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])}#M(){let t={};if(this.#a)for(let e in this.#a)this.#a.hasOwnProperty(e)&&!e.startsWith("_")&&(t[e]=this.#a[e]?"granted":"denied");return t}#L(t){if(this.#c.consentRequired&&!this.#a)return;const e=t.closest("[data-consent-tpl]");e&&(this.#_(`${e.dataset.consentTpl}.close.before`,e),e.classList.remove("is-open"),this.#_(`${e.dataset.consentTpl}.close.after`,e))}#u(t,e){for(const n in e)e.hasOwnProperty(n)&&(Array.isArray(e[n])?t[n]=e[n].slice():"object"==typeof e[n]&&null!==e[n]?(t[n]||(t[n]={}),this.#u(t[n],e[n])):t[n]=e[n]);return t}#O(t){return this.#l[t]||!1}#f(){window.dataLayer=window.dataLayer||[]}#b(){this.#c.gtm.loadContainer&&this.#c.gtm.containerId&&function(t,e,n,i,s){t[i]=t[i]||[],t[i].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var o=e.getElementsByTagName(n)[0],c=e.createElement(n);c.async=!0,c.src="https://www.googletagmanager.com/gtm.js?id="+s,o.parentNode.insertBefore(c,o)}(window,document,"script","dataLayer",this.#c.gtm.containerId)}#k(t){let e=this.#M();this.#c.gtm.loadContainer||"default"!=t||(e.event=`${this.#i}.${t}`),e.consentModel=this.#c.consentModel,window.dataLayer.push(e)}#_(t,e){const n=new CustomEvent(`${this.#i}:${t}`,{detail:e});document.dispatchEvent(n)}#D(){this.hide("modal"),this.hide("banner")}#v(){if(this.#a=this.storage,this.#a)return void this.#_("settings.load",this.#a);this.#a={},this.#c.consentModel=this.#c.consentModel.toLowerCase().trim(),["opt-in","opt-out"].includes(this.#c.consentModel)||(this.#c.consentModel="opt-in");let t={"opt-in":!1,"opt-out":!0}[this.#c.consentModel];navigator.globalPrivacyControl&&(t=!navigator.globalPrivacyControl&&t,this.#a._gpc=navigator.globalPrivacyControl);for(let[e,n]of Object.entries(this.#l))this.#a[e]=!!n.required||t;this.#_("settings.load",this.#a)}#S(){if(!this.#c.l10n)return;if(!this.#c.locale){const t=document.documentElement.lang;this.#c.locale=t||null}if(!this.#c.locale)return;this.#c.locale=this.#c.locale.toLowerCase();const t=this.#c.l10n[this.#c.locale];t&&(t.content&&(this.#c.content=this.#u(this.#c.content,t.content)),t.services&&(this.#c.services=t.services),t.types&&(this.#l=t.types))}#C(){const t=document.createElement("div");if(t.id=this.#c.ui.rootId,t.className=this.#c.ui.rootClass,this.#T(t,{"data-consent-tpl":"root"}),this.#r.modal=this.#$("modal",this.#c.content.modal),this.#T(this.#r.modal,{role:"dialog"}),this.#P(this.#r.modal),this.#I(this.#a,this.#r),t.appendChild(this.#r.modal),this.#r.banner=this.#$("banner",this.#c.content.banner),this.#P(this.#r.banner),this.#T(this.#r.banner,{"data-consent-placement":this.#c.ui.placement.banner.join(",")}),t.appendChild(this.#r.banner),this.#a._gpc){let e=t.querySelectorAll("[data-consent-notices]");for(let t of e){let e=this.#$("notice",this.#c.content.notices.gpc);this.#T(e,{"data-consent-tpl":"notice","data-consent-notice":"info"}),t.appendChild(e)}}this.#q(t),document.body.appendChild(t),this.#r.root=t,this.#x()}#P(t){const e=t.dataset.consentTpl,n=this.#c.actions[e],i=t.querySelector("[data-consent-actions]");if(i)for(let t of this.#c.actions[e]._order){if(!n.hasOwnProperty(t)||!n[t]||!this.#o.includes(t))continue;let s=document.createElement("button");this.#c.ui.actionClasses[t]&&(this.#c.ui.actionClasses._all&&s.classList.add(...this.#c.ui.actionClasses._all.split(" ")),s.classList.add(...this.#c.ui.actionClasses[t].split(" "))),s.setAttribute("data-consent-action",t),s.textContent=this.#c.content[e].actions[t],i.append(s)}}#I(){this.#g;for(let[t,e]of Object.entries(this.#l)){this.#l[t].key=t;const n=this.#$("type",e);this.#T(n,{"data-consent-type":t});const i=n.querySelector("input");i.checked=!!this.#a[t],e.required&&(i.disabled=!0,i.checked=!0),this.#r.modal.querySelector("[data-consent-types]").appendChild(n)}this.#r.settings=this.#r.modal.querySelectorAll("[data-consent-settings] input")}#q(t){const e=this.#c.content.links,n=t.querySelectorAll("[data-consent-links]");if(n.length)for(let t of n){let n=0;for(let i in e){if(!e.hasOwnProperty(i)||!e[i])continue;if(n>0){let e=document.createElement("span");e.setAttribute("data-consent-link-delimiter",""),t.appendChild(e)}let s=document.createElement("a");s.href=e[i].url,s.textContent=e[i].text,t.appendChild(s),n++}if(t.closest('[data-consent-tpl="modal"]')&&this.#c.ui.showBranding){let e=document.createElement("a");e.setAttribute("data-consent-branding",""),e.href="https://github.com/derekcavaliero/simpleconsent/",e.textContent=`Powered by ${this.#h}`,t.appendChild(e)}}}#$(t,e={}){const n=document.createElement("template");n.innerHTML=this.#c.templates[t].trim();for(let t in e)e.hasOwnProperty(t)&&!["actions","required"].includes(t)&&"string"==typeof e[t]&&(n.innerHTML=this.#N(n.innerHTML,t,e[t]));return this.#T(n.content.firstChild,{"data-consent-tpl":t}),n.content.firstChild}#m(){if(this.#c.cookieDomain)return this.#c.cookieDomain;const t=window.location.hostname;if("localhost"===t)return"";const e=t.split(".").reverse();let n=e[1]+"."+e[0];return e.length>2&&e[1].length<=3&&(n=e[2]+"."+n),n}#N(t,e,n){let i=new RegExp(`{{ ${e} }}`,"g"),s=n.replace(/<[^>]*>?/gm,"");return s=this.#B(s),t.replace(i,s)}#B(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}#x(){const t=this.#c.consentRequired;this.#a._datetime||(t?this.show("modal"):this.show("banner"))}#U(t){["cookie","hybrid"].includes(this.#c.storageMethod)&&(document.cookie=`${this.#c.storageName}=${JSON.stringify(t)}; expires=${new Date(Date.now()+24*this.#c.cookieExpiryDays*60*60*1e3).toUTCString()}; path=/; domain=${this.#c.cookieDomain}`),["cookie","hybrid"].includes(this.#c.storageMethod)&&localStorage.setItem(this.#c.storageName,JSON.stringify(t))}accept(){this.changeAll(),this.save()}changeAll(t=!0){this.#r.settings.forEach((e=>{e.disabled||(e.checked=t)}))}deny(){this.changeAll(!1),this.save()}hide(t="modal"){this.#c.consentRequired&&!this.#a||this.#r[t].classList.remove("is-open")}reset(){document.cookie=`${this.#c.storageName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=${this.#c.cookieDomain}`,this.#a=null,this.#v(),this.#w(),this.changeAll("opt-in"!==this.#c.consentModel),this.#x()}save(t=!1){"function"==typeof this.#c.onUpdateBefore&&this.#c.onUpdateBefore(this.#a),this.#a||(this.#a={});for(let t of this.#r.settings){if("necessary"==t.name)continue;const e=this.#O(t.name);this.#a[t.name]=t.checked,e.mapTo&&Array.isArray(e.mapTo)&&e.mapTo.forEach((e=>{this.#a[e]=t.checked,this.#_(`${e}.${this.#E(t.checked)}`)}));t.checked;this.#_(`${t.name}.${this.#E(t.checked)}`)}Object.entries({_datetime:(new Date).toISOString(),_id:crypto.randomUUID(),_model:`${this.#c.consentModel}/`+(t?"implicit":"explicit"),_geo:this.#e,_version:this.#s}).forEach((([t,e])=>{this.#a[t]=e})),this.#U(this.#a),this.#_("settings.update",this.#a),"function"==typeof this.#c.onUpdateAfter&&this.#c.onUpdateAfter(this.#a),setTimeout((()=>this.#D()),150)}show(t="modal"){this.#_(`${t}.show.before`,this.#r[t]),this.#r[t].classList.add("is-open"),this.#_(`${t}.show.after`,this.#r[t])}static manager(t){return SimpleConsent.#t||(SimpleConsent.#t=new SimpleConsent(t)),SimpleConsent.#t}}document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelector("script[data-consent-config]");if(!t)return;let e=window[t.dataset.consentConfig]||{};new SimpleConsent(e),delete window[t.dataset.consentConfig]}));
