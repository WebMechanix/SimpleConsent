/**!
 * SimpleConsent.js
 * 
 * Author: Derek Cavaliero (@derekcavaliero)
 * Repository: https://github.com/derekcavaliero/SimpleConsent
 * Version: 1.0.alpha
 * License: MIT
 */
class SimpleConsent{static#t=null;#e=null;#n=null;#i="simple-consent";#s=1;#o=["acceptAll","acceptSelected","close","denyAll","saveSettings","showSettings"];#c={actions:{banner:{_order:["showSettings","denyAll","acceptAll"],showSettings:!0,denyAll:!0,acceptAll:!0},modal:{_order:["denyAll","saveSettings","acceptSelected","acceptAll"],acceptAll:!0,acceptSelected:!0,saveSettings:!0,denyAll:!0}},consentModel:"opt-in",consentOnImplicitAction:!1,consentRequired:!1,content:{banner:{heading:"Privacy Notice",description:"This website uses cookies (or other browser storage) to deliver our services and/or analyze our website usage. This information is also shared with advertising partners through the use of tracking scripts/pixels.",actions:{acceptAll:"Accept All",denyAll:"Deny All",showSettings:"Edit Preferences"}},notices:{required:{badge:"Always Enabled"},gpc:{badge:"Disabled by GPC",description:"Some services have been automatically disabled to respect your Global Privacy Control opt-out signal."}},modal:{heading:"Your Privacy Choices",description:"This website uses services that utilize storage features in your browser (via cookies or other browser storage functionality) to collect information. You can choose to grant or deny certain types of data collection using the controls below.",toggleAll:"Enable/Disable All",actions:{acceptAll:"Accept All",acceptSelected:"Accept Selected",denyAll:"Deny All",saveSettings:"Save Preferences"}},links:{privacyPolicy:{text:"Privacy Policy",url:"#/privacy-policy"},termsOfService:null,cookiePolicy:{text:"Cookie Policy",url:"#/cookie-policy"}}},cookieDomain:null,cookieExpiryDays:365,geoLocate:null,gtm:{loadContainer:!1,containerId:null},l10n:{},locale:null,onInit:function(t){},onUpdateAfter:function(t){},onUpdateBefore:function(t){},services:{},storageMethod:"hybrid",storageName:"simple_consent",templates:{banner:'<div class="consent-banner"><div class="consent-ui__content" role="alert" aria-labelledby="consentBannerHeading" aria-describedby="consentBannerDescription"><div class="consent-ui__header"><h2 class="consent-banner__heading" id="consentBannerHeading">{{ heading }}</h2><button aria-label="Close" data-consent-close></button></div><div class="consent-banner__description" id="consentBannerDescription">{{ description }}</div><div data-consent-notices></div><div data-consent-actions></div><div data-consent-links class="consent-ui__footer"></div></div></div>',modal:'<div class="consent-modal" aria-labelledby="consentModalHeading" aria-describedby="consentModalDescription"><div class="consent-ui__content"><div class="consent-ui__header"><h2 class="consent-modal__heading" id="consentModalHeading">{{ heading }}</h2><button aria-label="Close" data-consent-close></button></div><div class="consent-modal__description" id="consentModalDescription">{{ description }}</div><div data-consent-notices></div><form data-consent-settings><div data-consent-types class="consent-modal__body"></div><div data-consent-actions></div></form><div data-consent-links class="consent-ui__footer"></div></div></div>',notice:"<div>{{ description }}</div>",type:'<div class="consent-type"><div class="consent-switch"><input type="checkbox" role="switch" id="type-{{ key }}" name="{{ key }}"><div class="consent-switch__text"><label for="type-{{ key }}">{{ name }}</label><div>{{ description }}</div><div data-consent-type-services></div></div></div></div>'},types:{},ui:{actionClasses:{_all:null,acceptAll:null,acceptSelected:null,denyAll:null,showSettings:null,saveSettings:null},placement:{banner:["bottom","left"]},rootClass:"simple-consent",rootId:"simple-consent",showBranding:!0}};#a=null;#l={gpc:navigator.globalPrivacyControl||!1,dnt:navigator.doNotTrack||!1};#r={necessary:{key:"necessary",name:"Strictly Necessary",description:"These cookies/services are required for our website(s) to function properly and cannot be disabled.",required:!0}};#d={banner:null,modal:null,root:null,settings:null};constructor(t){if(SimpleConsent.#t)return SimpleConsent.#t;SimpleConsent.#t=this;try{this.#h(t)}catch(t){}}get#g(){return this.constructor.name}get#u(){const t={};for(let[e,n]of Object.entries(this.#c.services))for(let e of n.types)t[e]||(t[e]=[]),t[e].push(n);return t}get config(){return this.#c}get signals(){return this.#l}get storage(){if(this.#a)return this.#a;if(["localstorage","hybrid"].includes(this.#c.storageMethod)){let t=localStorage.getItem(this.#c.storageName);if(t)return this.#a=JSON.parse(t),this.#a}if(["cookie","hybrid"].includes(this.#c.storageMethod)){let t=`${this.#c.storageName}=`,e=decodeURIComponent(document.cookie).split(";");for(let n=0;n<e.length;n++){let i=e[n];for(;" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return JSON.parse(i.substring(t.length,i.length))}}return null}async#h(t){if(t._default){this.#n=t,t=t._default,this.#c=this.#p(this.#c,t);let e=this.#n._router;this.#c.geoLocate&&"function"==typeof this.#c.geoLocate&&this.#c.geoLocate().then((t=>{this.#e=t,e?(e.forEach((e=>{e.geoMatch&&t.match(e.geoMatch)&&this.#n.hasOwnProperty(e.config)&&(this.#c=this.#p(this.#c,this.#n[e.config]))})),this.#m()):this.#m()}))}else this.#c=this.#p(this.#c,t),this.#m()}#m(){this.#c.cookieDomain=this.#f(),this.#r=this.#p(this.#r,this.#c.types),this.#y(),this.#v(),this.#b(),this.#A(),this.#w(),this.#S(),this.#k(),this.#C(),"function"==typeof this.#c.onInit&&(this.#c.onInit(this.#a),this.#_("init",this.#a))}#v(){document.addEventListener(`${this.#i}:modal.show.before`,(t=>{const e=t.detail.querySelectorAll("[data-consent-action]");if(!this.#a._datetime)return e.forEach((t=>{t.style.display="saveSettings"!==t.getAttribute("data-consent-action")?"block":"none"})),void this.hide("banner");e.forEach((t=>{t.style.display="saveSettings"!==t.getAttribute("data-consent-action")?"none":"block"}))})),document.addEventListener(`${this.#i}:modal.close.before`,(t=>{this.#a._datetime||this.show("banner")})),document.addEventListener(`${this.#i}:settings.update`,(t=>{this.#L("update")})),document.addEventListener(`${this.#i}:settings.load`,(t=>{this.#L("default")}))}#w(){document.addEventListener("keyup",(t=>{"Escape"===t.key&&this.#d.modal&&this.#d.modal.classList.contains("is-open")&&this.#d.modal.querySelector("[data-consent-close]").click()})),document.addEventListener("click",(t=>{let e=t.target.closest("[data-consent-action]");if(e)return t.preventDefault(),void this[{showSettings:"show",acceptAll:"accept",acceptSelected:"save",denyAll:"deny",saveSettings:"save"}[e.dataset.consentAction]]();t.target.hasAttribute("data-consent-close")&&(t.preventDefault(),this.#T(t.target))}))}#S(){if(!this.#c.consentOnImplicitAction||this.#a)return;const t=()=>{this.changeAll(),this.save(!0),o()},e=e=>{window.scrollY<.05*window.innerHeight||t()},n=((t,e)=>{let n;return function(...i){clearTimeout(n),n=setTimeout((()=>t.apply(this,i)),e)}})(e,100);this.#c.consentOnImplicitAction.includes("scroll")&&document.addEventListener("scroll",n);const i=e=>{e.target.closest("[data-consent-tpl]")||t()};this.#c.consentOnImplicitAction.includes("click")&&document.addEventListener("mousedown",i);const s=e=>{t()};this.#c.consentOnImplicitAction.includes("banner.close")&&document.addEventListener(`${this.#i}:banner.close.after`,s);const o=()=>{document.removeEventListener("mousedown",i),document.removeEventListener(`${this.#i}:banner.close.after'`,s),document.removeEventListener("scroll",e)}}#E(t){return t?"granted":"denied"}#M(t,e){for(const n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])}#O(){let t={};if(this.#a)for(let e in this.#a)this.#a.hasOwnProperty(e)&&!e.startsWith("_")&&(t[e]=this.#a[e]?"granted":"denied");return t}#T(t){if(this.#c.consentRequired&&!this.#a)return;const e=t.closest("[data-consent-tpl]");e&&(this.#_(`${e.dataset.consentTpl}.close.before`,e),e.classList.remove("is-open"),this.#_(`${e.dataset.consentTpl}.close.after`,e))}#p(t,e){for(const n in e)e.hasOwnProperty(n)&&(Array.isArray(e[n])?t[n]=e[n].slice():"object"==typeof e[n]&&null!==e[n]?(t[n]||(t[n]={}),this.#p(t[n],e[n])):t[n]=e[n]);return t}#D(t){return this.#r[t]||!1}#y(){window.dataLayer=window.dataLayer||[]}#A(){this.#c.gtm.loadContainer&&this.#c.gtm.containerId&&function(t,e,n,i,s){t[i]=t[i]||[],t[i].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var o=e.getElementsByTagName(n)[0],c=e.createElement(n);c.async=!0,c.src="https://www.googletagmanager.com/gtm.js?id="+s,o.parentNode.insertBefore(c,o)}(window,document,"script","dataLayer",this.#c.gtm.containerId)}#L(t){let e=this.#O();this.#c.gtm.loadContainer||"default"!=t||(e.event=`${this.#i}.${t}`),e.consentModel=this.#c.consentModel,window.dataLayer.push(e)}#_(t,e){const n=new CustomEvent(`${this.#i}:${t}`,{detail:e});document.dispatchEvent(n)}#$(){this.hide("modal"),this.hide("banner")}#b(){if(this.#a=this.storage,this.#a)return void this.#_("settings.load",this.#a);this.#a={},this.#c.consentModel=this.#c.consentModel.toLowerCase().trim(),["opt-in","opt-out"].includes(this.#c.consentModel)||(this.#c.consentModel="opt-in");let t={"opt-in":!1,"opt-out":!0}[this.#c.consentModel];this.#l.gpc&&(t=!this.#l.gpc&&t);for(let[e,n]of Object.entries(this.#r))this.#a[e]=!!n.required||t;this.#_("settings.load",this.#a)}#k(){if(!this.#c.l10n)return;if(!this.#c.locale){const t=document.documentElement.lang;this.#c.locale=t||null}if(!this.#c.locale)return;this.#c.locale=this.#c.locale.toLowerCase();const t=this.#c.l10n[this.#c.locale];t&&(t.content&&(this.#c.content=this.#p(this.#c.content,t.content)),t.services&&(this.#c.services=t.services),t.types&&(this.#r=t.types))}#C(){const t=document.createElement("div");if(t.id=this.#c.ui.rootId,t.className=this.#c.ui.rootClass,this.#M(t,{"data-consent-tpl":"root"}),this.#d.modal=this.#P("modal",this.#c.content.modal),this.#M(this.#d.modal,{role:"dialog"}),this.#I(this.#d.modal),this.#q(this.#a,this.#d),t.appendChild(this.#d.modal),this.#d.banner=this.#P("banner",this.#c.content.banner),this.#I(this.#d.banner),this.#M(this.#d.banner,{"data-consent-placement":this.#c.ui.placement.banner.join(",")}),t.appendChild(this.#d.banner),this.#l.gpc){let e=t.querySelectorAll("[data-consent-notices]");for(let t of e){let e=this.#P("notice",this.#c.content.notices.gpc);this.#M(e,{"data-consent-tpl":"notice","data-consent-notice":"info"}),t.appendChild(e)}}this.#x(t),document.body.appendChild(t),this.#d.root=t,this.#N()}#I(t){const e=t.dataset.consentTpl,n=this.#c.actions[e],i=t.querySelector("[data-consent-actions]");if(i)for(let t of this.#c.actions[e]._order){if(!n.hasOwnProperty(t)||!n[t]||!this.#o.includes(t))continue;let s=document.createElement("button");this.#c.ui.actionClasses[t]&&(this.#c.ui.actionClasses._all&&s.classList.add(...this.#c.ui.actionClasses._all.split(" ")),s.classList.add(...this.#c.ui.actionClasses[t].split(" "))),s.setAttribute("data-consent-action",t),s.textContent=this.#c.content[e].actions[t],i.append(s)}}#q(){this.#u;for(let[t,e]of Object.entries(this.#r)){this.#r[t].key=t;const n=this.#P("type",e);this.#M(n,{"data-consent-type":t});const i=n.querySelector("input");i.checked=!!this.#a[t],e.required&&(i.disabled=!0,i.checked=!0),this.#l.gpc&&e.gpc&&(i.disabled=!0,i.checked=!1),this.#d.modal.querySelector("[data-consent-types]").appendChild(n)}this.#d.settings=this.#d.modal.querySelectorAll("[data-consent-settings] input")}#x(t){const e=this.#c.content.links,n=t.querySelectorAll("[data-consent-links]");if(n.length)for(let t of n){let n=0;for(let i in e){if(!e.hasOwnProperty(i)||!e[i])continue;if(n>0){let e=document.createElement("span");e.setAttribute("data-consent-link-delimiter",""),t.appendChild(e)}let s=document.createElement("a");s.href=e[i].url,s.textContent=e[i].text,t.appendChild(s),n++}if(t.closest('[data-consent-tpl="modal"]')&&this.#c.ui.showBranding){let e=document.createElement("a");e.setAttribute("data-consent-branding",""),e.href="https://github.com/derekcavaliero/simpleconsent/",e.textContent=`Powered by ${this.#g}`,t.appendChild(e)}}}#P(t,e={}){const n=document.createElement("template");n.innerHTML=this.#c.templates[t].trim();for(let t in e)e.hasOwnProperty(t)&&!["actions","required"].includes(t)&&"string"==typeof e[t]&&(n.innerHTML=this.#B(n.innerHTML,t,e[t]));return this.#M(n.content.firstChild,{"data-consent-tpl":t}),n.content.firstChild}#f(){if(this.#c.cookieDomain)return this.#c.cookieDomain;const t=window.location.hostname;if("localhost"===t)return"";const e=t.split(".").reverse();let n=e[1]+"."+e[0];return e.length>2&&e[1].length<=3&&(n=e[2]+"."+n),n}#B(t,e,n){let i=new RegExp(`{{ ${e} }}`,"g"),s=n.replace(/<[^>]*>?/gm,"");return s=this.#U(s),t.replace(i,s)}#U(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}#N(){const t=this.#c.consentRequired;this.#a._datetime||(t?this.show("modal"):this.show("banner"))}#j(t){["cookie","hybrid"].includes(this.#c.storageMethod)&&(document.cookie=`${this.#c.storageName}=${JSON.stringify(t)}; expires=${new Date(Date.now()+24*this.#c.cookieExpiryDays*60*60*1e3).toUTCString()}; path=/; domain=${this.#c.cookieDomain}`),["cookie","hybrid"].includes(this.#c.storageMethod)&&localStorage.setItem(this.#c.storageName,JSON.stringify(t))}accept(){this.changeAll(),this.save()}changeAll(t=!0){this.#d.settings.forEach((e=>{e.disabled||(e.checked=t)}))}deny(){this.changeAll(!1),this.save()}hide(t="modal"){this.#c.consentRequired&&!this.#a||this.#d[t].classList.remove("is-open")}reset(){document.cookie=`${this.#c.storageName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=${this.#c.cookieDomain}`,this.#a=null,this.#b(),this.#S(),this.changeAll("opt-in"!==this.#c.consentModel),this.#N()}save(t=!1){"function"==typeof this.#c.onUpdateBefore&&this.#c.onUpdateBefore(this.#a),this.#a||(this.#a={});for(let t of this.#d.settings){if("necessary"==t.name)continue;const e=this.#D(t.name);this.#a[t.name]=t.checked,e.mapTo&&Array.isArray(e.mapTo)&&e.mapTo.forEach((e=>{this.#a[e]=t.checked,this.#_(`${e}.${this.#E(t.checked)}`)}));t.checked;this.#_(`${t.name}.${this.#E(t.checked)}`)}Object.entries({_datetime:(new Date).toISOString(),_id:crypto.randomUUID(),_geo:this.#e,_gpc:this.#l.gpc,_model:`${this.#c.consentModel}/`+(t?"implicit":"explicit"),_version:this.#s}).forEach((([t,e])=>{this.#a[t]=e})),this.#j(this.#a),this.#_("settings.update",this.#a),"function"==typeof this.#c.onUpdateAfter&&this.#c.onUpdateAfter(this.#a),setTimeout((()=>this.#$()),150)}show(t="modal"){this.#_(`${t}.show.before`,this.#d[t]),this.#d[t].classList.add("is-open"),this.#_(`${t}.show.after`,this.#d[t])}static manager(t){return SimpleConsent.#t||(SimpleConsent.#t=new SimpleConsent(t)),SimpleConsent.#t}}document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelector("script[data-consent-config]");if(!t)return;let e=window[t.dataset.consentConfig]||{};new SimpleConsent(e),delete window[t.dataset.consentConfig]}));
