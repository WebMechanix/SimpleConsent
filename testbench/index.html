<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SimpleConsent TestBench</title>

<script>
dataLayer = window.dataLayer || [];
</script>

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ§ª</text></svg>">
<link rel="preconnect" href="https://use.typekit.net">
<link rel="preconnect" href="https://fonts.bunny.net">
<link rel="preconnect" href="https://cdn.jsdelivr.net">

<!-- Styles -->
<link rel="stylesheet" href="https://use.typekit.net/dlq7tmk.css">
<link rel="stylesheet" href="https://fonts.bunny.net/css?family=fira-code:400,500">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ace-builds@1.35.4/css/ace.min.css">
<link rel="stylesheet" href="./assets/testbench.css">
<link rel="stylesheet" href="../dist/SimpleConsent.css">

<!-- Scripts --> 
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/ace-builds@1.35.4/src-min-noconflict/ace.min.js"></script>

<script defer src="./assets/components.js" type="module"></script>
<script defer src="./assets/testbench.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

<!-- SimpleConsent -->
<script defer src="../dist/SimpleConsent.js"></script>

</head>
<body class="d-flex flex-row align-items-stretch" x-data="{ json_console: (location.search.includes('json_console=false') ? false : true) }">
  
  <div class="w-100 vh-100 mx-auto overflow-auto" data-testbench-html>

    <header data-testbench-header class="position-sticky z-3 top-0 start-0 end-0 p-3 shadow-sm border-bottom border-secondary-subtle bg-white">
      <form data-testbench-controls x-data class="d-flex align-items-center justify-content-between gap-3">
        
        <h1 class="brand d-flex align-items-center gap-3 my-0 fw:800 lh-sm">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="0 0 512 512"
            class="aspect:1/1 rounded-3"
          >
            <defs>
              <style>
                .wmx-gradient--optimism-to-daydream {
                  fill: url(#wmx-gradient--optimism-to-daydream);
                }
              </style>
              <linearGradient
                id="wmx-gradient--optimism-to-daydream"
                x1="-46.26"
                y1="430.51"
                x2="558.26"
                y2="81.49"
                gradientUnits="userSpaceOnUse"
              >
                <stop offset="0" stop-color="#009fd4" />
                <stop offset="1" stop-color="#46b756" />
              </linearGradient>
            </defs>
            <rect
              class="wmx-gradient--optimism-to-daydream"
              x=".5"
              y=".5"
              width="511"
              height="511"
            />
            <path d="m511,1v510H1V1h510m1-1H0v512h512V0h0Z" />
            <path
              fill="#ffffff"
              d="m411.76,131.04c-3.31-4.61-8.39-8.19-13.99-9.73l.76.26c-17.29-6.15-65.86-9.47-113.67-10.24h-64.08c-45.77,1.28-90.79,4.35-107.57,10.24l.76-.26c-5.59,1.54-10.68,5.12-13.99,9.73-12.97,17.93-13.99,97.82-13.99,121.89v5.89c0,24.33,1.02,104.22,14.24,121.89,3.31,4.61,8.39,8.2,13.99,9.73l-.76-.25c20.85,7.17,86.46,10.5,142.15,10.5h.76c55.69,0,121.3-3.33,142.15-10.5l-.76.25c5.59-1.54,10.68-5.12,13.99-9.73,13.22-17.67,14.24-97.82,14.24-121.89v-5.89c0-24.07-1.02-103.97-14.24-121.89Zm-12.03,129.79c0,58.45-4.81,95.72-8.36,103.89l-.25.25c-12.67,4.34-63.6,9.19-133.02,9.19h-1.01c-21.03,0-40.29-.51-57.52-1.28-2.53-2.81-5.07-5.61-7.6-7.91,1.01-3.06,2.03-6.13,2.79-9.19.76-3.06,1.27-6.38,1.27-9.44,5.07-1.28,10.39-3.06,15.46-5.11-.25-3.06-.25-6.13-.76-9.19-5.32-1.53-10.64-2.55-16.22-3.32-.76-3.06-1.77-6.13-2.79-9.19-1.27-2.81-2.53-5.87-4.31-8.42,3.55-4.34,6.84-8.68,9.63-13.53-1.77-2.55-3.8-4.85-5.83-6.89-5.32,1.79-10.39,4.34-14.95,7.15-2.28-2.04-4.81-4.08-7.6-5.62-2.53-1.79-5.57-3.06-8.36-4.34.51-5.36.51-10.98,0-16.59-2.79-.77-5.57-1.53-8.61-2.04-3.04,4.85-5.83,9.7-8.11,14.8-3.04-.26-6.08-.26-9.37,0-3.04.51-6.08.77-9.12,1.79-2.79-4.85-6.08-9.44-9.38-13.53-.25,0-.51.26-.76.26v-13.62c0-61.35,4.81-100.47,8.36-109.05h.25c12.67-4.55,63.6-9.65,133.28-9.65h1.01c69.68,0,120.61,4.82,133.02,9.65h.25c3.55,8.57,8.36,47.69,8.36,109.05v1.88h.25Z"
            />
          </svg>
          <span class="fs-5">
            SimpleConsent 
            <span class="d-block fw-medium smaller text-muted">
              <span class="lh-1">ðŸ§ª</span> TestBench
            </span>
          </span>
        </h1>
      
        <div data-testbench-inputs class="d-flex flex-wrap flex-md-nowrap align-items-stretch gap-2">

          <div class="input-group flex-nowrap w-100 w-md-auto">
            <label class="input-group-text" for="config" data-bs-toggle="tooltip" data-bs-title="Config" data-bs-placement="bottom">
              <sprite-icon symbol="braces"></sprite-icon>
            </label>
            <select class="form-select flex-shrink-1" x-model="$store.app.controls.config" name="config" id="config" @change="$store.app.changeConfig($el.value)">
              <optgroup label="Default">
                <template x-for="[key, config] in Object.entries($store.app.configs.default)">
                  <option :selected="key == $store.app.controls.config" :value="key" x-text="key"></option>
                </template>
              </optgroup>
              <template x-if="Object.keys($store.app.configs.custom).length > 0">
                <optgroup label="Custom">
                  <template x-for="[key, config] in Object.entries($store.app.configs.custom)">
                    <option :selected="key == $store.app.controls.config" :value="key" x-text="$store.app.getConfigOptionLabel(key)"></option>
                  </template>
                </optgroup>
              </template>
            </select>
            <button x-show="$store.app.controls.config.startsWith('custom.')" class="btn btn-secondary btn-icon" data-bs-toggle="tooltip" data-bs-title="Edit Config" data-bs-placement="bottom" @click="$store.editor.edit()" type="button">
              <sprite-icon symbol="pencil"></sprite-icon>
            </button>
            <button class="btn btn-secondary btn-icon" data-bs-toggle="tooltip" data-bs-title="New Config" data-bs-placement="bottom" @click="$store.editor.new()" type="button">
              <sprite-icon symbol="plus"></sprite-icon>
            </button>
          </div>

          <div class="input-group flex-nowrap w-100 w-md-auto">
            <label class="input-group-text" for="lang" data-bs-toggle="tooltip" data-bs-title="Locale" data-bs-placement="bottom">
              <sprite-icon symbol="translate"></sprite-icon>
            </label>
            <select class="form-select flex-shrink-1" x-model="$store.app.controls.lang" @change="$store.app.changeLang($el.value)" name="lang" id="lang">
              <option value="ar">ðŸ‡¦ðŸ‡ª Arabic</option>
              <option value="bn">ðŸ‡§ðŸ‡© Bengali</option>
              <option value="zh">ðŸ‡¨ðŸ‡³ Chinese</option>
              <option value="da">ðŸ‡©ðŸ‡° Danish</option>
              <option value="nl">ðŸ‡³ðŸ‡± Dutch</option>
              <option value="en" selected>ðŸ‡¬ðŸ‡§ English</option>
              <option value="fi">ðŸ‡«ðŸ‡® Finnish</option>
              <option value="fr">ðŸ‡«ðŸ‡· French</option>
              <option value="de">ðŸ‡©ðŸ‡ª German</option>
              <option value="el">ðŸ‡¬ðŸ‡· Greek</option>
              <option value="he">ðŸ‡®ðŸ‡± Hebrew</option>
              <option value="hi">ðŸ‡®ðŸ‡³ Hindi</option>
              <option value="it">ðŸ‡®ðŸ‡¹ Italian</option>
              <option value="ja">ðŸ‡¯ðŸ‡µ Japanese</option>
              <option value="ko">ðŸ‡°ðŸ‡· Korean</option>
              <option value="no">ðŸ‡³ðŸ‡´ Norwegian</option>
              <option value="pl">ðŸ‡µðŸ‡± Polish</option>
              <option value="pt-BR">ðŸ‡§ðŸ‡· Portuguese (Brazilian)</option>
              <option value="pt-PT">ðŸ‡µðŸ‡¹ Portuguese (European)</option>
              <option value="ru">ðŸ‡·ðŸ‡º Russian</option>
              <option value="es">ðŸ‡ªðŸ‡¸ Spanish</option>
              <option value="sv">ðŸ‡¸ðŸ‡ª Swedish</option>
              <option value="th">ðŸ‡¹ðŸ‡­ Thai</option>
              <option value="tr">ðŸ‡¹ðŸ‡· Turkish</option>
              <option value="uk">ðŸ‡ºðŸ‡¦ Ukrainian</option>
              <option value="vi">ðŸ‡»ðŸ‡³ Vietnamese</option>
            </select>
          </div>

          <div class="input-group flex-nowrap w-md-auto">
            <label class="input-group-text" for="container_id" data-bs-toggle="tooltip" data-bs-title="Container ID" data-bs-placement="bottom">GTM-</label>
            <input class="form-control font-monospace" type="text" x-model="$store.app.controls.containerId" name="container_id" id="container_id" placeholder="PTLD5H79">
          </div>

        </div>

        <div data-testbench-actions class="d-flex align-items-stretch justify-content-between gap-3">
          <div class="d-none d-lg-block form-check form-switch align-self-center m-0">
            <input class="form-check-input" x-model="json_console" type="checkbox" role="switch" name="json_console" id="json_console" checked>
            <label class="form-check-label fw-medium text-muted" for="json_console">Console</label>
          </div>
          <div class="d-flex gap-2 align-self-stretch">
            <button class="btn btn-secondary btn-icon" type="button" data-bs-toggle="tooltip" data-bs-title="Reset Manager" data-bs-placement="bottom" onclick="SimpleConsent.manager().reset();">
              <sprite-icon symbol="arrow-clockwise"></sprite-icon>
            </button>
            <button class="btn btn-primary btn-icon" type="submit" data-bs-toggle="tooltip" data-bs-title="Swap Settings" data-bs-placement="bottom">
              <sprite-icon symbol="arrow-left-right"></sprite-icon>
            </button>
          </div>
        </div>

      </form>
    </header>

    <main data-testbench-body class="container px-3 pt-5 pb-4">

      <div class="position-relative">
        <hr class="mb-5 mt-0 border-style-dashed">
        <span class="badge text-bg-secondary fw-medium font-monospace text-uppercase rounded-pill absolute-center">Tag Log</span>
      </div>
      
      <div 
        x-data="{ 
          get tags() { 
            return $store.log.tags 
          },
          pulsingTags: new Set(),
          pulse() {
            this.pulsingTags = new Set($store.log.updatedTags);
            setTimeout(() => {
              this.pulsingTags.clear();
              $store.log.clearUpdatedTags();
            }, 1000);
          }
        }"
        x-effect="$store.log.updatedTags.size > 0 && pulse()">

        <template x-for="(tag, index) in $store.log.tags" :key="index" x-cloak>
          <div :data-tag-id="tag.id" :data-tag-key="tag.key" :class="{ 'animate:pulse': pulsingTags.has(tag.key) }" class="card p-3 mt-2 flex-row align-items-center justify-content-between lh-1 small">
            <div class=" d-flex gap-2 align-items-center text-muted mr-auto">
              <span x-text="tag.totalFired" class="badge text-bg-primary"></span>
              <sprite-icon symbol="tag-fill"></sprite-icon>
              <span x-text="tag.name" class="font-monospace"></span>
            </div>
            <sprite-icon class="text-success" symbol="check-circle-fill"></sprite-icon>
          </div>
        </template>

      </div>

      <div class="position-relative">
        <hr class="my-5 border-style-dashed">
        <span class="badge text-bg-secondary fw-medium font-monospace text-uppercase rounded-pill absolute-center">End Tag Log</span>
      </div>

      <div class="d-flex align-items-center justify-content-center gap-2 text-center text-muted mt-4">
        <button class="btn btn-link btn-sm p-0" data-consent-action="showSettings">Open Settings Modal</button>
      </div>

    </main>

    <footer data-testbench-footer x-cloak class="w-100 position-sticky bottom-0 end-0 z-3 d-flex align-items-center justify-content-between bg-white shadow-sm:up border-top border-secondary-subtle text-muted small">
      <div class="px-3" x-data="{year: new Date()}"> 
        &copy; <template x-if="year.getFullYear() > 2024"><span>2024-</span></template><span x-text="year.getFullYear()"></span> 
        Built by <a href="https://www.derekcavaliero.com" class="hover:text-underline">Derek Cavaliero</a>
        @ <a href="https://www.webmechanix.com" class="hover:text-underline">WebMechanix</a>,
        a <a href="https://www.level.agency" class="hover:text-underline">Level Agency</a>
      </div>
      <a class="d-inline-flex gap-1 align-items-center p-3 bg-black fw-bold lh-1 text-white text-decoration-none hocus:text-optimism transition:color" href="https://github.com/derekcavaliero/simpleconsent/">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/>
        </svg>
        <!-- <span>GitHub</span> -->
      </a>
    </footer>

  </div>

  <aside data-testbench-console :class="{ 'd-lg-none': ! json_console }" class="d-none d-lg-block w-50 flex-shrink-0 vh-100 d-flex flex-column align-items-stretch justify-content-stretch border-end border-2 bg-gray-700 border-dark">
    <div x-data="{label: 'Resolved Config'}" class="h-50 position-relative overflow-hidden border-bottom border-2 border-dark">
      <div 
        data-ace-editor="config"
        class="m-0 overflow-auto position-absolute w-100 h-100"  
        x-init="$watch('$store.app.configs.resolved', () => {
          $nextTick(() => {
            Alpine.store('app').setConsoleValue('config', $store.app.configs.resolved);
          });
        })"></div>
        <code class="position-absolute top-0 end-0 m-3 font-monospace bg-gray-900 fw-medium small px-2 py-1 rounded-1" x-text="label"></code>
    </div>
    <div x-data="{label: 'dataLayer'}" class="h-50 position-relative overflow-hidden border-bottom border-2 border-dark">
      <div 
        data-ace-editor="dataLayer"
        class="m-0 overflow-auto position-absolute w-100 h-100"  
        x-init="$watch('$store.app.dataLayer', () => {
          $nextTick(() => {
            Alpine.store('app').setConsoleValue(label, $store.app.dataLayer);
          });
        })"></div>
      <code class="position-absolute top-0 end-0 m-3 font-monospace bg-gray-900 fw-medium small px-2 py-1 rounded-1" x-text="label"></code>
    </div>
  </aside>

  <!-- Modal: #configEditor -->
  <form data-testbench-config-editor x-data class="modal fade" id="configEditor" tabindex="-1" aria-labelledby="configEditorHeader" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
      <div class="modal-content bg-dark" style="height: 85vh;">
        <div class="modal-header border-black">
          <h2 class="modal-title h5 fw-bold text-light" id="configEditorHeader">
          <template x-if="$store.editor.mode === 'new'">
            <span>New Config</span>
          </template>
          <template x-if="$store.editor.mode === 'edit'">
            <code x-text="$store.editor.name"></code>
          </template>
          </h2>
          <button type="button" class="btn-close filter-invert:1" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body position-relative d-flex flex-column bg-editor p-0">
          <div data-ace-editor="modalEditor" class="w-100 h-100"></div>
          <input type="hidden" name="config_json" x-model="$store.editor.json">
          <template x-if="$store.editor.mode === 'new'">
            <div>
              <hr class="border-1 border-black m-0">
              <input class="form-control p-3 rounded-0 border-0 bg-transparent focus:none font-monospace small" type="text" name="config_name" x-model="$store.editor.name" pattern="[a-zA-Z0-9\- ]{3,}" required placeholder="Enter your config name..." title="Config name may only contain alpha-numeric characters, spaces, and hyphens." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
            </div>
          </template>
          <template x-if="$store.editor.mode === 'edit'">
            <input type="hidden" name="config_name" x-model="$store.editor.name" pattern="[a-zA-Z0-9\- ]{3,}">
          </template>
        </div>
        <div class="modal-footer justify-content-start gap-3 border-black">
          <input type="hidden" name="mode" x-model="$store.editor.mode">
          <button type="submit" class="btn btn-secondary">Save Config</button>
          <template x-if="$store.editor.mode === 'edit'">
            <button type="button" class="btn btn-danger ms-auto" @click="$store.app.removeConfig($store.editor.name)">Delete Config</button>
          </template>
          <template x-if="($store.editor.mode === 'new') && $store.editor.name">
            <p class="d-flex gap-2 align-items-center text-light m-0">
              <sprite-icon symbol="info-circle-fill"></sprite-icon> 
              <span>
                Config will be stored in localStorage as:
                <code class="bg-transparent position-relative" x-text="'simple-consent:' + $store.editor.makeConfigKey()"></code>
              </span>
            </p>
          </template>
        </div>
      </div>
    </div>
  </form>

</body>
</html>